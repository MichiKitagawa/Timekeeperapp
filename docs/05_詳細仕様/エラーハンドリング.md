# 🔥 エラーハンドリング仕様 - Timekeeper

---

## 1. API エラー

すべての API エラーは以下形式で返却：

```json
{
  "error":   "<エラーコード>",
  "message": "<ユーザー向け説明>"
}

```

|ステータス|エラーコード|用途|
|---|---|---|
|400|`invalid_purchase_token`|purchase_token の形式/検証エラー|
|400|`invalid_request`|JSON フォーマット・必須フィールド不足|
|404|`device_not_found`|device_id 未登録|
|500|`stripe_verification_failed`|Stripe API 検証失敗|
|500|`payment_verification_failed`|デイパス課金検証失敗|

---

## 2. クライアント内エラー画面

### P06: 汎用エラー画面

|発生条件|表示メッセージ|ボタン|
|---|---|---|
|ライセンス未購入 → 他画面アクセス|「ライセンス購入が必要です」|「購入画面へ」|
|JSON パースエラー|「予期しないエラーが発生しました」|「再試行」|

### P05: デイパス内部反映失敗

| 発生条件                       | 表示メッセージ                   | ボタン      |
| -------------------------- | ------------------------- | -------- |
| Stripe 成功 → Firestore 更新失敗 | 「課金は成功しましたが、ロック解除に失敗しました」 | 「問い合わせる」 |