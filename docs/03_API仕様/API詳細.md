# ğŸ“˜ APIè©³ç´° - Timekeeperï¼ˆv2ä»•æ§˜ï¼‰

---

## å…±é€šä»•æ§˜

- **ãƒ™ãƒ¼ã‚¹URL**: `https://api.timekeeper.example.com`
- **èªè¨¼**: JSONãƒœãƒ‡ã‚£å†…ã«å¿…ãš `device_id` ã‚’å«ã‚ã‚‹ï¼ˆåŒ¿åè­˜åˆ¥ï¼‰
- **ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å‹**: `application/json`
- **HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**:

|ã‚³ãƒ¼ãƒ‰|ç”¨é€”|
|---|---|
|200|æ­£å¸¸å‡¦ç†|
|400|ãƒªã‚¯ã‚¨ã‚¹ãƒˆå½¢å¼ï¼ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼|
|404|`device_id` æœªç™»éŒ²|
|500|ã‚µãƒ¼ãƒãƒ¼å†…éƒ¨ã‚¨ãƒ©ãƒ¼|

- **ã‚¨ãƒ©ãƒ¼å½¢å¼**:

```json
{
  "error": "<ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰>",
  "message": "<ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸>"
}

```

---

### POST `/license/confirm`

### ğŸ”¹ æ¦‚è¦

åˆå›ãƒ©ã‚¤ã‚»ãƒ³ã‚¹è³¼å…¥å®Œäº†ã®é€šçŸ¥ã¨çŠ¶æ…‹ç™»éŒ²ï¼æ›´æ–°

- **å‘¼ã³å‡ºã—å…ƒ**: P01ï¼ˆãƒ©ã‚¤ã‚»ãƒ³ã‚¹è³¼å…¥ç”»é¢ï¼‰

### ğŸ”¸ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

```json
{
  "device_id": "abc123-uuid",
  "purchase_token": "cs_test_XXXXXXXXXXXXX"
}

```

### ğŸ”¸ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

|ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰|å‹|å¿…é ˆ|åˆ¶ç´„|
|---|---|---|---|
|`device_id`|string|âœ“|UUIDå½¢å¼|
|`purchase_token`|string|âœ“|Stripe ã‚»ãƒƒã‚·ãƒ§ãƒ³ ID|

### ğŸ”¸ æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ 200

```json
{ "status": "ok" }

```

### ğŸ”¸ ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹

|ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹|ãƒ¬ã‚¹ãƒãƒ³ã‚¹|
|---|---|
|400|`{ "error": "invalid_purchase_token", "message": "purchase_token ãŒä¸æ­£ã§ã™" }`|
|404|`{ "error": "device_not_found", "message": "device_id ãŒæœªç™»éŒ²ã§ã™" }`|
|500|`{ "error": "stripe_verification_failed", "message": "æ±ºæ¸ˆæ¤œè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ" }`|

---

### POST `/unlock/daypass`

### ğŸ”¹ æ¦‚è¦

ãƒ‡ã‚¤ãƒ‘ã‚¹ï¼ˆ1æ—¥ã‚¢ãƒ³ãƒ­ãƒƒã‚¯ï¼‰èª²é‡‘å®Œäº†ã®é€šçŸ¥ã¨çŠ¶æ…‹æ›´æ–°

- **å‘¼ã³å‡ºã—å…ƒ**: P05ï¼ˆãƒ‡ã‚¤ãƒ‘ã‚¹æ±ºæ¸ˆç”»é¢ï¼‰

### ğŸ”¸ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

```json
{
  "device_id": "abc123-uuid",
  "purchase_token": "cs_test_YYYYYYYYYYYYY"
}

```

### ğŸ”¸ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

|ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰|å‹|å¿…é ˆ|åˆ¶ç´„|
|---|---|---|---|
|`device_id`|string|âœ“|UUIDå½¢å¼|
|`purchase_token`|string|âœ“|Stripe ã‚»ãƒƒã‚·ãƒ§ãƒ³ ID|

### ğŸ”¸ æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ 200

```json
{
  "status": "ok",
  "unlock_count": 4,
  "last_unlock_date": "2025-05-25"
}

```

### ğŸ”¸ ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹

| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ãƒ¬ã‚¹ãƒãƒ³ã‚¹                                                                      |
| ----- | -------------------------------------------------------------------------- |
| 400   | `{ "error": "invalid_purchase_token", "message": "purchase_token ãŒä¸æ­£ã§ã™" }` |
| 404   | `{ "error": "device_not_found", "message": "device_id ãŒæœªç™»éŒ²ã§ã™" }`           |
| 500   | `{ "error": "payment_verification_failed", "message": "æ±ºæ¸ˆæ¤œè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ" }`     |